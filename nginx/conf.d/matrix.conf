server {
  listen 80;
  server_name matrix-hotline.chilllab.dev;

  # If you terminate TLS elsewhere (e.g., Nginx Proxy Manager), you can remove this server block
  # and only keep the upstream routing there.

  # Optional HTTP->HTTPS redirect if you have certs mounted for 443:
  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl http2;
  server_name matrix-hotline.chilllab.dev;

  ssl_certificate     /etc/nginx/ssl/fullchain.pem;
  ssl_certificate_key /etc/nginx/ssl/privkey.pem;

  client_max_body_size 50M;

  # Element Web at /
  location / {
    proxy_pass http://element:80;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Synapse client API
  location ~ ^(/_matrix|/_synapse/client) {
    proxy_pass http://synapse:8008;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
  }
}
